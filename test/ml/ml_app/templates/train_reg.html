{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="apple-touch-icon" sizes="76x76" href="../assets/img/apple-icon.png">
  <link rel="icon" type="image/png" href="../assets/img/favicon.png">
  <title>
    Fibré - Train and Predict
  </title>
  <!--     Fonts and icons     -->
  <link rel="icon" type="image/x-icon" href='{% static "image/logo.png" %}'>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css" />
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="{% static 'css/main.css' %}" />
  <!-- Font Awesome Icons -->
  <script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
  <script src="https://cdn.datatables.net/1.12.0/js/jquery.dataTables.min.js"></script>
  <style>
    body {
        background-image: url('{% static "image/background.jpg" %}');
        background-size: cover;
        background-repeat: no-repeat;
        background-attachment: fixed;
    }
</style>
</head>
{% if accuracy_scores %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const alertMessage = document.getElementById('alert-message');
        const customAlert = document.getElementById('custom-alert');

        if (alertMessage && customAlert) {
            alertMessage.innerText = "Training Sucessful! Mean Absolute Error is {{ accuracy_scores }}";
            customAlert.classList.add('show'); 
        }
    });

    function closeAlert() {
        const customAlert = document.getElementById('custom-alert');

        if (customAlert) {
            customAlert.classList.remove('show'); 
        }
    }
</script>
{% endif %}
<body class="g-sidenav-show  bg-gray-100">
    <aside class="sidenav navbar navbar-vertical navbar-expand-xs border-0 border-radius-xl my-3 fixed-start ms-3" style="overflow: hidden !important;"
        id="sidenav-main">
        <div class="sidenav-header">
            <i class="fas fa-times p-3 cursor-pointer text-secondary opacity-5 position-absolute end-0 top-0 d-none d-xl-none"
                aria-hidden="true" id="iconSidenav"></i>
            <a class="navbar-brand m-0" href=" https://demos.creative-tim.com/soft-ui-dashboard/pages/dashboard.html "
                target="_blank">
                <img src='{% static "image/logo.png" %}' class="navbar-brand-img h-100" alt="main_logo">
                <span class="ms-1 font-weight-bold inactive" style="font-size: 20px !important;">Fibré</span>
            </a>
        </div>
        <hr class="horizontal dark mt-0">
        <div class="collapse navbar-collapse  w-auto ">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'home_reg' %}">
                        <div
                            class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 d-flex align-items-center justify-content-center">
                            <span class="material-symbols-outlined">
                                home
                            </span>
                        </div>
                        <span class="nav-link-text ms-1 inactive">Home</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'eda_reg' %}">
                        <div
                            class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 d-flex align-items-center justify-content-center">
                            <span class="material-symbols-outlined">
                                monitoring</span>
                        </div>
                        <span class="nav-link-text ms-1 inactive">EDA</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link " href="{% url 'add_data_reg' %}">
                        <div
                            class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 d-flex align-items-center justify-content-center">
                            <span class="material-symbols-outlined">
                                add
                                </span>
                        </div>
                        <span class="nav-link-text ms-1 inactive">Add Data</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link  active" href="{% url 'train_reg' %}">
                        <div
                            class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 d-flex align-items-center justify-content-center">
                            <span class="material-symbols-outlined">
                                model_training</span>
                        </div>
                        <span class="nav-link-text ms-1">Train</span>
                    </a>
                </li>
                <li class="nav-item mt-3">
                    <h6 class="ps-4 ms-2 text-uppercase text-xs font-weight-bolder opacity-6 inactive" >Account pages</h6>
                </li>
                <li class="nav-item">
                    <a class="nav-link  " href="{% url 'home_class' %}">
                        <div
                            class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 d-flex align-items-center justify-content-center">
                            <svg width="12px" height="12px" viewBox="0 0 40 44" version="1.1"
                                xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                                <span class="material-symbols-outlined">
                                    alt_route
                                </span>
                            </svg>
                        </div>
                        <span class="nav-link-text ms-1 inactive" >Classification</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link  " href="{% url 'logout' %}">
                        <div
                            class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 d-flex align-items-center justify-content-center">
                            <svg width="12px" height="20px" viewBox="0 0 40 40" version="1.1"
                                xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                                <span class="material-symbols-outlined">
                                    logout
                                </span>

                            </svg>
                        </div>
                        <span class="nav-link-text ms-1 inactive">Logout</span>
                    </a>
                </li>
            </ul>
        </div>

    </aside>
  <main class="main-content position-relative max-height-vh-100 h-100 border-radius-lg ">
    <!-- Navbar -->
    <nav class="navbar navbar-main navbar-expand-lg px-0 mx-4 shadow-none border-radius-xl" id="navbarBlur" navbar-scroll="true">
      <div class="container-fluid py-1 px-3">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb bg-transparent mb-0 pb-0 pt-1 px-0 me-sm-6 me-5">
            <li class="breadcrumb-item text-sm"><a class="opacity-5" href="javascript:;">Regression</a></li>
            <li class="breadcrumb-item text-sm active" aria-current="page">Train and Predict</li>
          </ol>
          <h6 class="font-weight-bolder mb-0">Train and Predict</h6>
        </nav>
        <div class="collapse navbar-collapse mt-sm-0 mt-2 me-md-0 me-sm-4" id="navbar">
          <div class="ms-md-auto pe-md-3 d-flex align-items-center">
          </div>
          <ul class="navbar-nav  justify-content-end">
            <li class="nav-item d-flex align-items-center">
              <a href="javascript:;" class="nav-link text-body font-weight-bold px-0">
                <i class="fa fa-user me-sm-1"></i>
                <span class="d-sm-inline d-none">User Profile</span>
              </a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <!-- End Navbar -->
    <div class="container-fluid py-4">
        <div class="row">
          <div class="">
            <div class="row">
              <div class="">
                <div class="card">
                  <div class="overflow-hidden position-relative border-radius-xl">
                    <span class="mask"></span>
                    <div class="card-body position-relative z-index-1 p-3">
                        <center><h4>Train Dataset</h4>
                            <h6>Since Linear Regression don't have hyperparameters that we can use for tuning, you can directly click the "Train Model" button.
                                For your information, to train the model, Test Train Split with a ratio of 80:20 and a random seed of 10 will be used.
                            </h6>
                            <button class="submit btn-eda" onclick="window.location.href='{% url 'postTrain_reg' %}'">Train</button></center>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
        </div>
        <div class="row">
          <div class="col-md-7 mt-4">
            <div class="card">
              <div class="card-header pb-0 px-3">
                <center><h4 class="mb-0">Set Attribute Values</h4></center>
              </div>
              <div class="card-body pt-4 p-3">
                <form id="predictionForm" method="post">
                    {% csrf_token %}
                    <div class="slider_row">

                        <div class="slider_input">
                            <label for="team" class="slider_label">Team</label>
                            <input type="range" name="team" id="team" min="1" max="12" aria-expanded="false"
                                required>
                            <span id="team-value" class="input_value"></span>
                        </div>
                    </div>
                    <div class="slider_row">

                        <div class="slider_input">
                            <label for="days" class="slider_label">Days</label>
                            <input type="range" name="days" id="days" min="1" max="7"
                                aria-expanded="false" required>
                            <span id="days-value" class="input_value"></span>
                        </div>
                    </div>
                    <div class="slider_row">

                        <div class="slider_input">
                            <label for="quart" class="slider_label">Quart</label>
                            <input type="range" name="quart" id="quart" min="1" max="5" aria-expanded="false"
                                required>
                            <span id="quart-value" class="input_value"></span>
                        </div>
                    </div>

                    <div class="slider_row">

                        <div class="slider_input">
                            <label for="dept" class="slider_label">Department</label>
                            <input type="range" name="dept" id="dept" min="0" max="1" aria-expanded="false"
                                required>
                            <span id="dept-value" class="input_value"></span>
                        </div>
                    </div>

                    <div class="slider_row">

                        <div class="slider_input">
                            <label for="targeted_productivity" class="slider_label">Targeted Productivity</label>
                            <input type="range" name="targeted_productivity" id="targeted_productivity" min="0" max="1" step="any"
                                aria-expanded="false" required>
                            <span id="targeted_productivity-value" class="input_value"></span>
                        </div>
                    </div>

                    <div class="slider_row">
                        <div class="slider_input">
                            <label for="smv" class="slider_label">SMV</label>
                            <input type="range" name="smv" id="smv" min="0" max="100"
                                step="any" aria-expanded="false" required>
                            <span id="smv-value" class="input_value"></span>
                        </div>
                    </div>

                    <div class="slider_row">
                        <div class="slider_input">
                            <label for="wip" class="slider_label">WIP</label>
                            <input type="range" name="wip" id="wip" min="0" max="10000"
                                step="any" aria-expanded="false" required>
                            <span id="wip-value" class="input_value"></span>
                        </div>
                    </div>
                    <div class="slider_row">
                        <div class="slider_input">
                            <label for="over_time" class="slider_label">Over Time </label>
                            <input type="range" name="over_time" id="over_time" min="0" max="10000" step="any"
                                aria-expanded="false" required>
                            <span id="over_time-value" class="input_value"></span>
                        </div>
                    </div>

                    <div class="slider_row">
                        <div class="slider_input">
                            <label for="incentive" class="slider_label">Incentive</label>
                            <input type="range" name="incentive" id="incentive" min="0" max="100"
                                aria-expanded="false" required>
                            <span id="incentive-value" class="input_value"></span>
                        </div>
                    </div>

                    <div class="slider_row">
                        <div class="slider_input">
                            <label for="idle_time" class="slider_label">Idle Time</label>
                            <input type="range" name="idle_time" id="idle_time" min="0" max="100" step="any"
                                aria-expanded="false" required>
                            <span id="idle_time-value" class="input_value"></span>
                        </div>
                    </div>

                    <div class="slider_row">
                        <div class="slider_input">
                            <label for="idle_men" class="slider_label">Idle Men</label>
                            <input type="range" name="idle_men" id="idle_men" min="0" max="100" step="any"
                                aria-expanded="false" required>
                            <span id="idle_men-value" class="input_value"></span>
                        </div>
                    </div>

                    <div class="slider_row">
                        <div class="slider_input">
                            <label for="no_of_style_change" class="slider_label">No. of Style Change</label>
                            <input type="range" name="no_of_style_change" id="no_of_style_change" min="0" max="100" step="any"
                                aria-expanded="false" required>
                            <span id="no_of_style_change-value" class="input_value"></span>
                        </div>
                    </div>

                    <div class="slider_row">
                        <div class="slider_input">
                            <label for="no_of_workers" class="slider_label">No. of Workers</label>
                            <input type="range" name="no_of_workers" id="no_of_workers" min="0" max="100" step="any"
                                aria-expanded="false" required>
                            <span id="no_of_workers-value" class="input_value"></span>
                        </div>
                    </div>
                </form>
              </div>
            </div>
          </div>
          <div class="col-md-5 mt-4">
            <div class="card h-100 mb-4">
              <div class="card-header pb-0 px-3">
                <div class="">
                  <div class="">
                    <center><h4 class="mb-0">Prediction</h4></center>
                  </div>
                </div>
              </div>
              <div class="card-body pt-4 p-3">
                <div class="results">
                    <div class="result_text"></div>
                    <img class="result_img">
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="custom-alert" class="alert-container">
        {% load static %}
        <center><span class="material-symbols-outlined done">
                done
            </span></center>
        <p id="alert-message"></p>
        <span class="close-btn" onclick="closeAlert()">×</span>
    </div>
  </main>
  
</body>

</html>

<script>
    // Function to format the value with six decimal places
    function formatValue(value) {
        return parseFloat(value).toFixed(2);
    }

    // Function to update value display when the slider is changed
    function updateValueDisplay(sliderId, valueDisplayId, inputType) {
        const slider = document.getElementById(sliderId);
        const valueDisplay = document.getElementById(valueDisplayId);

        if (slider && valueDisplay) {
            const value = parseFloat(slider.value);

            if (inputType === 'float') {
                // If the input type is 'float', display with six decimal places
                valueDisplay.textContent = formatValue(value);
            } else {
                // If the input type is 'int', round to the nearest whole number
                valueDisplay.textContent = Math.round(value);
            }
        }
    }

    // Add event listeners for each slider
    document.getElementById('team').addEventListener('input', function () {
        const inputType = 'int';
        updateValueDisplay('team', 'team-value', inputType);
    });

    document.getElementById('days').addEventListener('input', function () {
        const inputType = 'int';
        updateValueDisplay('days', 'days-value', inputType);
    });

    document.getElementById('quart').addEventListener('input', function () {
        const inputType = 'int';
        updateValueDisplay('quart', 'quart-value', inputType);
    });

    document.getElementById('dept').addEventListener('input', function () {
        const inputType = 'int';
        updateValueDisplay('dept', 'dept-value', inputType);
    });

    document.getElementById('targeted_productivity').addEventListener('input', function () {
        const inputType = 'float';
        updateValueDisplay('targeted_productivity', 'targeted_productivity-value', inputType);
    });

    document.getElementById('smv').addEventListener('input', function () {
        const inputType = 'float';
        updateValueDisplay('smv', 'smv-value', inputType);
    });

    document.getElementById('wip').addEventListener('input', function () {
        const inputType = 'float';
        updateValueDisplay('wip', 'wip-value', inputType);
    });

    document.getElementById('over_time').addEventListener('input', function () {
        const inputType = 'float';
        updateValueDisplay('over_time', 'over_time-value', inputType);
    });

    document.getElementById('incentive').addEventListener('input', function () {
        const inputType = 'int';
        updateValueDisplay('incentive', 'incentive-value', inputType);
    });

    document.getElementById('idle_time').addEventListener('input', function () {
        const inputType = 'float';
        updateValueDisplay('idle_time', 'idle_time-value', inputType);
    });

    document.getElementById('idle_men').addEventListener('input', function () {
        const inputType = 'float';
        updateValueDisplay('idle_men', 'idle_men-value', inputType);
    });

    document.getElementById('no_of_style_change').addEventListener('input', function () {
        const inputType = 'float';
        updateValueDisplay('no_of_style_change', 'no_of_style_change-value', inputType);
    });

    document.getElementById('no_of_workers').addEventListener('input', function () {
        const inputType = 'float';
        updateValueDisplay('no_of_workers', 'no_of_workers-value', inputType);
    });

</script>

<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

<script>
    $(document).ready(function () {
        // Function to update the result on the page
        function updateResult(predictedLabel) {
            
            // Update the result section
            $('.result_text').html("The productivity rate of the workers is: <strong style='color: white !important;'>" + predictedLabel + "</strong>");
        }

        // Submit the form using AJAX when sliders change
        $('form').on('input', function (e) {
            e.preventDefault();  // Prevent the default form submission

            // Serialize the form data
            var formData = $(this).serialize();

            // Make an AJAX POST request
            $.ajax({
                type: 'POST',
                url: '/postPredict_reg/',
                data: formData,
                headers: { 'X-CSRFToken': $('input[name=csrfmiddlewaretoken]').val() },
                success: function (data) {
                    // Update the result on success
                    console.log(data)
                    updateResult(data.predicted_label);
                },
                error: function (error) {
                    console.error('Error:', error);
                }
            });
        });
    });
</script>